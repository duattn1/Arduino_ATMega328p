/** @file ledMatrix_Max7219.c
 *  @brief Function implementation for LED matrix based on Max7219.
 *
 *  This is the source file for the definition of LED matrix based on Max7219.
 *
 *  @author Tran Nhat Duat (duattn)
 *  @version V1.0
 */

#ifdef USE_MAX7219_KIT
 
/*******************************************************************************
 * 1. Included Files
 ******************************************************************************/
#include "ledMatrix_Max7219.h"

/*******************************************************************************
 * 2. Object-like Macros
 ******************************************************************************/


/*******************************************************************************
 * 3. Function-like Macros
 ******************************************************************************/


/*******************************************************************************
 * 4. Typedefs: Enumerations, Structures, Pointers, Others
 ******************************************************************************/


/*******************************************************************************
 * 5. Global, Static and Extern Variables
 ******************************************************************************/
const uint8_t CharacterLib_array[43][8]={
{0x3C,0x42,0x42,0x42,0x42,0x42,0x42,0x3C},//0
{0x10,0x18,0x14,0x10,0x10,0x10,0x10,0x10},//1
{0x7E,0x02,0x02,0x7E,0x40,0x40,0x40,0x7E},//2
{0x3E,0x02,0x02,0x3E,0x02,0x02,0x3E,0x00},//3
{0x08,0x18,0x28,0x48,0xFE,0x08,0x08,0x08},//4
{0x3C,0x20,0x20,0x3C,0x04,0x04,0x3C,0x00},//5
{0x3C,0x20,0x20,0x3C,0x24,0x24,0x3C,0x00},//6
{0x3E,0x22,0x04,0x08,0x08,0x08,0x08,0x08},//7
{0x00,0x3E,0x22,0x22,0x3E,0x22,0x22,0x3E},//8
{0x3E,0x22,0x22,0x3E,0x02,0x02,0x02,0x3E},//9
{0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},//:
{0,0,0,0,0,0,0,0},//;
{0,0,0,0,0,0,0,0},//<
{0,0,0,0,0,0,0,0},//=
{0,0,0,0,0,0,0,0},//>
{0,0,0,0,0,0,0,0},//?
{0,0,0,0,0,0,0,0},//@
{0x08,0x14,0x22,0x3E,0x22,0x22,0x22,0x22},//A
{0x3C,0x22,0x22,0x3E,0x22,0x22,0x3C,0x00},//B
{0x3C,0x40,0x40,0x40,0x40,0x40,0x3C,0x00},//C
{0x7C,0x42,0x42,0x42,0x42,0x42,0x7C,0x00},//D
{0x7C,0x40,0x40,0x7C,0x40,0x40,0x40,0x7C},//E
{0x7C,0x40,0x40,0x7C,0x40,0x40,0x40,0x40},//F
{0x3C,0x40,0x40,0x40,0x40,0x44,0x44,0x3C},//G
{0x44,0x44,0x44,0x7C,0x44,0x44,0x44,0x44},//H
{0x7C,0x10,0x10,0x10,0x10,0x10,0x10,0x7C},//I
{0x3C,0x08,0x08,0x08,0x08,0x08,0x48,0x30},//J
{0x00,0x24,0x28,0x30,0x20,0x30,0x28,0x24},//K
{0x40,0x40,0x40,0x40,0x40,0x40,0x40,0x7C},//L
{0x81,0xC3,0xA5,0x99,0x81,0x81,0x81,0x81},//M
{0x00,0x42,0x62,0x52,0x4A,0x46,0x42,0x00},//N
{0x3C,0x42,0x42,0x42,0x42,0x42,0x42,0x3C},//O
{0x3C,0x22,0x22,0x22,0x3C,0x20,0x20,0x20},//P
{0x1C,0x22,0x22,0x22,0x22,0x26,0x22,0x1D},//Q
{0x3C,0x22,0x22,0x22,0x3C,0x24,0x22,0x21},//R
{0x00,0x1E,0x20,0x20,0x3E,0x02,0x02,0x3C},//S
{0x00,0x3E,0x08,0x08,0x08,0x08,0x08,0x08},//T
{0x42,0x42,0x42,0x42,0x42,0x42,0x22,0x1C},//U
{0x42,0x42,0x42,0x42,0x42,0x42,0x24,0x18},//V
{0x00,0x49,0x49,0x49,0x49,0x2A,0x1C,0x00},//W
{0x00,0x41,0x22,0x14,0x08,0x14,0x22,0x41},//X
{0x41,0x22,0x14,0x08,0x08,0x08,0x08,0x08},//Y
{0x00,0x7F,0x02,0x04,0x08,0x10,0x20,0x7F},//Z
};

/*******************************************************************************
 * 6. Function Definitions
 ******************************************************************************/
void write_Max7219_byte(uint8_t data_uint8) {
	Gpio_DigitalWrite(CS_PIN, Low);
	for(uint8_t i = 8; i >= 1; i--) {
		Gpio_DigitalWrite(CLK_PIN, Low);

		if(data_uint8 & 0x80) { // TODO:Extracting a bit data
			Gpio_DigitalWrite(MOSI_PIN, High);
		} else {
			Gpio_DigitalWrite(MOSI_PIN, Low);
		}

	data_uint8 = data_uint8 << 1;
	Gpio_DigitalWrite(CLK_PIN, High);
	}
}

void write_Max7219(uint8_t address_uint8, uint8_t data_uint8) {
	Gpio_DigitalWrite(CS_PIN, Low);
	write_Max7219_byte(address_uint8);
	write_Max7219_byte(data_uint8); 
	Gpio_DigitalWrite(CS_PIN, High);
}

void init_Max7219(void) {
	write_Max7219(0x09, 0x00);       //decoding :BCD
	write_Max7219(0x0a, 0x03);       //brightness
	write_Max7219(0x0b, 0x07);       //scanlimit;8 LEDs
	write_Max7219(0x0c, 0x01);       //power-down mode:0,normal mode:1
	write_Max7219(0x0f, 0x00);       //test display:1;EOT,display:0
}

#endif /* USE_MAX7219_KIT */

/** End of File ***************************************************************/
